<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Quotation</title>
    <style>
        @font-face {
            font-family: 'Sarabun';
            src: url('file:///usr/local/share/fonts/sarabun/Sarabun-Regular.ttf') format('truetype');
            font-weight: normal;
        }
        @font-face {
            font-family: 'Sarabun';
            src: url('file:///usr/local/share/fonts/sarabun/Sarabun-Bold.ttf') format('truetype');
            font-weight: bold;
        }
        @page {
            size: A4;
            margin: 0.3cm 2cm 0.7cm 2.5cm;
        }
        body {
            font-family: 'Sarabun', sans-serif;
            font-size: 14px;
            line-height: 1.3;
            margin: 0;
            padding-top: 0cm;
            padding-bottom: 0cm;
        }
        .document-content {
            padding-bottom: 120px; /* reserve space so content pushes to a new page before footer */
        }
        .header-logo {
            text-align: center;
            margin-top: 5px;
        }
        .header-logo img {
            height: 80px;
            max-width: 200px;
            object-fit: contain;
        }
        .footer-logo {
            text-align: center;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            margin-bottom: 5px;
        }
        .footer-logo img {
            height: 80px;
            max-width: 200px;
            object-fit: contain;
        }
        .quotation-title {
            font-size: 20px;
            font-weight: bold;
            text-align: right;
            margin: 10px 0;
            padding: 5px;
            display: block;
        }
        .info-container {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .company-info {
            flex: 1;
        }
        .quotation-info {
            text-align: right;
            margin-left: 20px;
        }
        .customer-info {
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }
        th, td {
            border: 1px solid black;
            padding: 0.3em 0.5em;
            text-align: left;
            vertical-align: top;
            line-height: 1.2;
        }
        th {
            background-color: #f0f0f0;
            font-weight: bold;
            text-align: center;
        }
        td.number {
            text-align: right;
        }
        td.center {
            text-align: center;
        }
        .total-row {
            font-weight: bold;
            text-align: center;
        }
        .total-row td {
            font-weight: bold;
        }
        .total-row-text {
            font-weight: bold;
            text-align: right;
        }
        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .signature-box {
            text-align: center;
            width: 45%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .signature-content {
            margin-bottom: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .signature-content img {
            height: 80px;
            max-height: 80px;
            width: auto;
        }
        .signature-space {
            height: 80px;
        }
        .signature-line {
            border-top: 1px solid black;
            padding-top: 2px;
            margin-top: 2px;
            width: 100%;
        }
        .details-section {
            margin: 20px 0;
            page-break-inside: avoid;
        }
        .details-title {
            font-weight: bold;
            margin-top: 15px;
        }
        .details-content {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    {% if header_logo %}
    <div class="header-logo">
        <img src="{{ header_logo }}" alt="Header Logo">
    </div>
    {% endif %}

    <div class="document-content">
        <div class="quotation-title">ใบเสนอราคา / Quotation</div>

        <div class="info-container">
            <div class="company-info">
                <div style="font-weight: bold;">{{ data.company.name }}</div>
                <div>{{ data.company.address_1 }}, {{ data.company.address_2 }}</div>
                <div>โทร. / Tel: {{ data.company.tel }}</div>
                <div>เลขประจําตัวผู้เสียภาษี / Tax ID: {{ data.company.tax_id }}</div>
            </div>
            <div class="quotation-info">
                <div>เลขที่ / No: {{ data.document_no }}</div>
                <div>วันที่ / Date: {{ data.issue_date | format_date_thai_eng }}</div>
            </div>
        </div>

        <div class="customer-info">
            <div style="font-weight: bold;">ลูกค้า / Customer:</div>
            <div>{{ customer.name }}</div>
            <div>{{ customer.address }}</div>
            <div>โทร / Tel: {{ customer.tel }}</div>
            {% if customer.tax_id and customer.tax_id.strip() %}
            <div>เลขประจําตัวผู้เสียภาษี / Tax ID: {{ customer.tax_id }}</div>
            {% endif %}
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 7%;">ลำดับ<br>No.</th>
                    <th style="width: 50%;">รายการ<br>Description</th>
                    <th style="width: 10%;">จำนวน<br>Qty</th>
                    <th style="width: 18%;">ราคาต่อหน่วย<br>Unit Price</th>
                    <th style="width: 15%;">จำนวนเงิน<br>Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td class="center">{{ loop.index }}</td>
                    <td>{{ item.description }}</td>
                    <td class="center">{{ item.qty }}</td>
                    <td class="number">{{ "{:,.2f}".format((item.price or 0)|float) }}</td>
                    <td class="number">{{ "{:,.2f}".format((item.total or 0)|float) }}</td>
                </tr>
                {% endfor %}
                {% if data.totals.tax > 0 %}
                <tr class="total-row">
                    <td colspan="2" class="total-row-text">ภาษีมูลค่าเพิ่ม / VAT (7%)</td>
                    <td colspan="3" class="number">{{ "{:,.2f}".format((data.totals.tax or 0)|float) }}</td>
                </tr>
                {% endif %}
                <tr class="total-row">
                    <td colspan="2" class="total-row-text">รวมเป็นเงิน / Total</td>
                    <td colspan="3" class="number">{{ "{:,.2f}".format((data.totals.total or 0)|float) }}<br>({{ (data.totals.total or 0)|float | number_to_thai_text }})</td>
                </tr>
            </tbody>
        </table>

        {% if data.start_date and data.end_date %}
        <div class="details-section">
            <div class="details-title">ระยะเวลาการทำงาน / Project Duration:</div>
            <div class="details-content">{{ data.start_date | format_date_thai_eng }} - {{ data.end_date | format_date_thai_eng }}</div>
        </div>
        {% endif %}

        {% if data.scope and data.scope.strip() %}
        <div class="details-section">
            <div class="details-title">ขอบเขตงาน / Scope of Work:</div>
            <div class="details-content">
                {% for line in data.scope.split('\n') %}
                {% if line.strip() %}
                <div>• {{ line.strip() }}</div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if data.deliverables and data.deliverables.strip() %}
        <div class="details-section">
            <div class="details-title">ผลงานที่ส่งมอบ / Deliverables:</div>
            <div class="details-content">
                {% for line in data.deliverables.split('\n') %}
                {% if line.strip() %}
                <div>• {{ line.strip() }}</div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if data.payment_terms and data.payment_terms.strip() %}
        <div class="details-section">
            <div class="details-title">การชำระเงิน / Payment Terms:</div>
            <div class="details-content">{{ data.payment_terms }}</div>
        </div>
        {% endif %}

        <div class="details-section">
            <div class="details-title">โอนเงินมาที่ / Bank Account:</div>
            <div class="details-content">{{ data.company.bank_account }}</div>
        </div>

        {% if data.note and data.note.strip() %}
        <div class="details-section">
            <div class="details-title">หมายเหตุ / Notes:</div>
            <div class="details-content">
                {% for line in data.note.split('\n') %}
                {% if line.strip() %}
                <div>• {{ line.strip() }}</div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="signature-section">
            <div class="signature-box">
                <div class="signature-space"></div>
                <div class="signature-line">ลงชื่อผู้สั่งซื้อ / Customer Signature</div>
                <div>วันที่ / Date: _________________</div>
            </div>
            <div class="signature-box">
                {% if signature_image %}
                <div class="signature-content">
                    <img src="{{ signature_image }}" alt="Signature" style="height: 80px;">
                </div>
                {% endif %}
                <div class="signature-line">ผู้มีอำนาจลงนาม / Authorized Signature</div>
                <div>วันที่ / Date: {{ current_date | format_date_thai_eng }}</div>
            </div>
        </div>
    </div>

    {% if footer_logo %}
    <div class="footer-logo">
        <img src="{{ footer_logo }}" alt="Footer Logo">
    </div>
    {% endif %}
</body>
</html>